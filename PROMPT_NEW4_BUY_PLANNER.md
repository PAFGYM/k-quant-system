# ì‹ ê·œ ê¸°ëŠ¥: íˆ¬ì ì½”ì¹­ ì‹œìŠ¤í…œ (ë§¤ìˆ˜ í”Œë˜ë„ˆ + ì‹¤ì‹œê°„ ì½”ì¹­ + ë§¤ë„ ê°€ì´ë“œ)

## í•µì‹¬ ì² í•™

ì´ ì‹œìŠ¤í…œì€ **ì „ì† íˆ¬ì ì°¸ëª¨**ë‹¤. ë‹¨ìˆœ ì¢…ëª© ì¶”ì²œì´ ì•„ë‹ˆë¼:

1. ì•„ì¹¨ì— ì‹œì¥ + ë³´ìœ ì¢…ëª© + ê¸°ê°„ë³„ ì¶”ì²œì„ í•œëˆˆì— ë¸Œë¦¬í•‘
2. ì‚¬ìš©ìê°€ ì¢…ëª©ì„ **ì¥ë°”êµ¬ë‹ˆì²˜ëŸ¼ ë‹´ìœ¼ë©´ì„œ** í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±
3. ë‹¨íƒ€ ì„ íƒ ì‹œ ëª¨ë‹ˆí„°ë§ì„ ìë™ ê°•í™”í•˜ê³  ì¥ì¤‘ ì½”ì¹­
4. ë³´ìœ ì¢…ëª© ì „ëµ ë³€ê²½ì€ ì „ë¬¸ì  ê·¼ê±° ê¸°ë°˜ìœ¼ë¡œë§Œ
5. ë§¤ë„ ì‹œì ì„ ìë™ ì•Œë¦¼ (ëª©í‘œê°€/ì†ì ˆê°€/ê¸°ê°„ ì´ˆê³¼)

**ì´ì „ ë¬¸ì œ ë°©ì§€ ê·œì¹™:**
- ëª©ì—… ë°ì´í„° ì‚¬ìš© ê¸ˆì§€ â†’ ì‹¤ì‹œê°„ KIS WebSocket + yfinanceë§Œ ì‚¬ìš©
- ê°€ê²© í• ë£¨ì‹œë„¤ì´ì…˜ ê¸ˆì§€ â†’ ì œê³µëœ ë°ì´í„°ë§Œ ì‚¬ìš© (í•™ìŠµ ë°ì´í„° ê°€ê²© ì‚¬ìš© ì ˆëŒ€ ê¸ˆì§€)
- "ê³„ì† íŒŒì„¸ìš”" ë°˜ë³µ ê¸ˆì§€ â†’ ë§¤ë„ ê·¼ê±°ê°€ ëª…í™•í•  ë•Œë§Œ, holding_typeì— ë”°ë¼ ì°¨ë“±
- ë³´ìœ ì¢…ëª© ë°˜ë³µ â†’ holding_typeì´ DBì— ì €ì¥ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì¥ê¸° ì¢…ëª©ì— ë‹¨ê¸° ë§¤ë„ ì œì•ˆ ì•ˆ í•¨

---

## ê²½ì œí•™ì  ê·¼ê±° (AI í”„ë¡¬í”„íŠ¸ì— ì£¼ì…í•  ì‚¬ê³  ì²´ê³„)

### ê¸°ëŒ€ìˆ˜ìµ(E[R]) í•„í„°
```
E[R] = P(ì„±ê³µ) Ã— ëª©í‘œìˆ˜ìµë¥  + P(ì‹¤íŒ¨) Ã— ì†ì ˆë¥ 
```
E[R] < 0.5%(ê±°ë˜ë¹„ìš©)ì´ë©´ ì¶”ì²œ ì•ˆ í•¨. "ì˜¤ëŠ˜ì€ ê´€ë§"ì´ í•©ë¦¬ì  ê²°ë¡ .

### Kelly Criterion (ì¢…ëª©ë³„ ë°°ë¶„)
```
f* = (p Ã— b - q) / b  â†’  Half Kelly ì ìš© (5~40% ë²”ìœ„)
```
3ì¢…ëª©ì´ë¼ë„ ê· ë“± ë¶„ë°°ê°€ ì•„ë‹˜. ìŠ¹ë¥ /ë°°ë‹¹ë¹„ì— ë”°ë¼ ì°¨ë“±.

### ì†ì‹¤ ë¹„ëŒ€ì¹­ì„±
-10% â†’ +11.1% í•„ìš”, -50% â†’ +100% í•„ìš”.
ì†ì ˆ ê¸°ì¤€ ì—„ìˆ˜ê°€ ìˆ˜ìµë³´ë‹¤ ì¤‘ìš”.

### ì‹œê°„ ê°€ì¹˜ (ê¸°íšŒë¹„ìš©)
ìê¸ˆ ë¬¶ì¸ ì‹œê°„ = ë¹„ìš©. 3ì¼ ë¯¸ë‹¬ ì‹œ ë³¸ì „ ë§¤ë„ ê²€í† .

---

## ê¸°ì¡´ ì¸í”„ë¼ (ìƒˆë¡œ ë§Œë“¤ í•„ìš” ì—†ìŒ)

- `KISWebSocket.on_update(callback)` â€” ì‹¤ì‹œê°„ ì²´ê²° ì½œë°± (kis_websocket.py:485). **í˜„ì¬ ì•„ë¬´ë„ ë“±ë¡ ì•ˆ í•¨** â†’ ì—¬ê¸°ì— ì—°ê²°
- ì½œë°± ì‹œê·¸ë‹ˆì²˜: `callback(event_type: str, ticker: str, data: RealtimePrice|Orderbook)`
- `RealtimePrice`: ticker, price, change, change_pct, volume, trade_volume, trade_time, bid_price, ask_price, total_ask_vol, total_bid_vol, `.pressure` ì†ì„±
- `job_ws_connect` (scheduler.py:1369) â€” 08:50 WebSocket ì—°ê²° + 62ì¢…ëª© êµ¬ë…
- `_scan_all_stocks()` (commands.py:8) â€” ì „ì²´ ìŠ¤ìº”
- `_analyze_stock()` (commands.py:55) â€” ì¢…ëª©ë³„ ë¶„ì„
- 7ê°€ì§€ ì „ëµ A~G (strategies.py), 100ì  ìŠ¤ì½”ì–´ë§ (scoring.py)
- `get_regime_mode(macro)` â€” VIX ê¸°ë°˜ ì‹œì¥ ë ˆì§ (ê³µê²©/ê· í˜•/ë°©ì–´)

### ì „ëµ ë§¤í•‘

| ì „ëµ | ì´ë¦„ | ëª©í‘œ | ì†ì ˆ | ë³´ìœ ê¸°ê°„ |
|------|------|------|------|----------|
| A | ë‹¨ê¸° ë°˜ë“± | +5% | -5% | 3~10ì¼ |
| B | ETF ë ˆë²„ë¦¬ì§€ | +3.5% | -3% | 1~3ì¼ |
| C | ì¥ê¸° ìš°ëŸ‰ì£¼ | +15% | -10% | 6ê°œì›”~1ë…„ |
| D | ì„¹í„° ë¡œí…Œì´ì…˜ | +10% | -7% | 1~3ê°œì›” |
| E | ê¸€ë¡œë²Œ ë¶„ì‚° | +12% | -8% | ì¥ê¸° |
| F | ëª¨ë©˜í…€ | +7% | -5% | 2~8ì£¼ |
| G | ëŒíŒŒ | +5% | -2% | 3~10ì¼ |

### ê¸°ê°„ â†’ ì „ëµ ë§¤í•‘

| ê¸°ê°„ | ë¼ë²¨ | ìš°ì„  ì „ëµ | ëª©í‘œ ìˆ˜ìµ | ì†ì ˆ |
|------|------|----------|----------|------|
| ë‹¨íƒ€ | âš¡ ë‹¹ì¼~3ì¼ | B, G | +3~20% (ATRë³„) | ATRë³„ -2~5% |
| ìŠ¤ìœ™ | ğŸ”¥ 3ì¼~2ì£¼ | A, G, F | +5~10% | -3% |
| í¬ì§€ì…˜ | ğŸ“Š 1~3ê°œì›” | D, F | +10~15% | -7% |
| ì¥ê¸° | ğŸ’ 6ê°œì›”+ | C, E | +15~30% | -10% |

### ë‹¨íƒ€ ë¦¬ìŠ¤í¬ ë“±ê¸‰ (ATR ê¸°ë°˜)

| ë“±ê¸‰ | ATR(20) | ëª©í‘œ | ì†ì ˆ | ëŒ€ìƒ |
|------|---------|------|------|------|
| A (ì•ˆì •) | < 2% | +3~5% | -2% | ëŒ€í˜•ì£¼/ETF |
| B (ë³´í†µ) | 2~4% | +5~10% | -3% | ì¤‘í˜•ì£¼ |
| C (ê³µê²©) | > 4% | +10~20% | -5% | ì†Œí˜•/í…Œë§ˆì£¼. ê³ ìœ„í—˜ ê²½ê³  í•„ìˆ˜ |

---

## ì „ì²´ ì‹œìŠ¤í…œ íë¦„

```
[07:50] ì•„ì¹¨ ë¸Œë¦¬í•‘
    â”œâ”€â”€ ë³´ìœ ì¢…ëª© í˜„í™© (ëª©í‘œ ëŒ€ë¹„ ì§„í–‰ë¥ , ìœ„í—˜ ê²½ê³ )
    â”œâ”€â”€ ë³´ìœ ì¢…ëª© ì „ëµ ë³€ê²½ ì œì•ˆ (ê·¼ê±° ìˆì„ ë•Œë§Œ)
    â”œâ”€â”€ ê¸°ê°„ë³„ ì¶”ì²œ (ë‹¨íƒ€/ìŠ¤ìœ™/í¬ì§€ì…˜/ì¥ê¸°)
    â””â”€â”€ [ë§¤ìˆ˜ ì‹œì‘] â†’ ì˜ˆì‚° ì…ë ¥ â†’ ì¥ë°”êµ¬ë‹ˆ ëª¨ë“œ
                        â”œâ”€â”€ ê¸°ê°„ë³„ ì¢…ëª© ë³´ê¸° / ğŸ¤– AI ì¶”ì²œ
                        â”œâ”€â”€ ì¢…ëª© ë‹´ê¸° â†’ ë‹¤ìŒ ì¢…ëª© â†’ ë‹´ê¸° (ë£¨í”„)
                        â””â”€â”€ [ì„ íƒ ì™„ë£Œ] â†’ ìµœì¢… í™•ì¸ â†’ [í™•ì •]
    â†“
[09:00~15:30] ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ (KIS WebSocket)
    â”œâ”€â”€ ê¸‰ë“± ê°ì§€ (+3% ì´ìƒ) â†’ ì•Œë¦¼
    â”œâ”€â”€ ë‹¨íƒ€ ì¢…ëª©: ëª¨ë‹ˆí„°ë§ ì£¼ê¸° ìë™ ë‹¨ì¶• + ìˆ˜ê¸‰ ì½”ì¹­
    â”œâ”€â”€ ëª©í‘œê°€ ë„ë‹¬ â†’ "ìˆ˜ìµ ì‹¤í˜„ ê²€í† " ì•Œë¦¼
    â”œâ”€â”€ ì†ì ˆê°€ ë„ë‹¬ â†’ "í¬ì§€ì…˜ ì •ë¦¬ ê²€í† " ì•Œë¦¼
    â””â”€â”€ [14:30] ë‹¨íƒ€ ë¯¸ì²­ì‚° â†’ "ì¢…ê°€ ë§¤ë„ ê²€í† " ì•Œë¦¼
    â†“
[08:00 ë‹¤ìŒë‚ ]
    â”œâ”€â”€ ìŠ¤ìœ™ 3ì¼ ë¯¸ë‹¬ â†’ "ë³¸ì „ ë§¤ë„ ê²€í† " ì•Œë¦¼
    â””â”€â”€ ë³´ìœ ì¢…ëª© ì „ëµ ì¬ì ê²€
```

---

## Part A: ì•„ì¹¨ ë¸Œë¦¬í•‘ (07:50 KST)

### ë¸Œë¦¬í•‘ ë©”ì‹œì§€ í˜•ì‹

```
â˜€ï¸ ì£¼í˜¸ë‹˜, ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”

â”â”â” ë³´ìœ ì¢…ëª© í˜„í™© â”â”â”
ì‚¼ì„±ì „ì (ğŸ’ì¥ê¸°): 74,500ì› (+2.3%)
  ğŸŸ¢ ëª©í‘œ +15% ì¤‘ 15% ë‹¬ì„±. ìˆœí•­ ì¤‘

ì—ì½”í”„ë¡œ (ğŸ”¥ìŠ¤ìœ™): 57,200ì› (-1.5%)
  âš ï¸ ì†ì ˆ -3%ê¹Œì§€ 50% ì ‘ê·¼. ì£¼ì˜

KODEX ë ˆë²„ë¦¬ì§€ (âš¡ë‹¨íƒ€): 17,900ì› (+0.5%)
  ğŸ“Œ ì˜¤ëŠ˜ ì¥ ë§ˆê° ì „ ì²­ì‚° í•„ìš”

â”â”â” ì‹œì¥ ìƒí™© â”â”â”
VIX 18.2 (ì•ˆì •) | ë‚˜ìŠ¤ë‹¥ +0.8%
âš–ï¸ ê· í˜• ëª¨ë“œ | ì›/ë‹¬ëŸ¬ 1,320ì›

â”â”â” ì˜¤ëŠ˜ì˜ ì¶”ì²œ â”â”â”

ğŸ’ ì¥ê¸° â€” ë°˜ë„ì²´ ì—…ì‚¬ì´í´ ì§„ì…
   SKí•˜ì´ë‹‰ìŠ¤, DBí•˜ì´í…

ğŸ“Š í¬ì§€ì…˜ â€” 2ì°¨ì „ì§€ ì¡°ì • ë§ˆë¬´ë¦¬
   ì—ì½”í”„ë¡œë¹„ì— , í¬ìŠ¤ì½”í“¨ì²˜ì— 

ğŸ”¥ ìŠ¤ìœ™ â€” ì™¸ì¸ ìˆœë§¤ìˆ˜ ì „í™˜ ì¢…ëª©
   í˜„ëŒ€ì°¨, ê¸°ì•„

âš¡ ë‹¨íƒ€ â€” ê±°ë˜ëŸ‰ í­ë°œ ì˜ˆìƒ
   KODEX ë ˆë²„ë¦¬ì§€
   â†’ ë‹¨íƒ€ ì„ íƒ ì‹œ ì¥ì¤‘ ìˆ˜ê¸‰ ëª¨ë‹ˆí„°ë§ ê°•í™”

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’° ë§¤ìˆ˜ ì˜ˆì‚°ì´ ìˆìœ¼ë©´ ì•Œë ¤ì£¼ì„¸ìš”

[ğŸ’° ë§¤ìˆ˜ ì‹œì‘] [ğŸ–ï¸ ì˜¤ëŠ˜ì€ ì‰´ê²Œ]
```

### ë³´ìœ ì¢…ëª© ì „ëµ ë³€ê²½ ì œì•ˆ (ê·¼ê±° ìˆì„ ë•Œë§Œ)

ì•„ì¹¨ ë¸Œë¦¬í•‘ì—ì„œ ë³´ìœ ì¢…ëª© ì „ëµ ë³€ê²½ì´ í•„ìš”í•œ ê²½ìš°ë§Œ ì¶”ê°€:

```
âš ï¸ ì „ëµ ë³€ê²½ ì œì•ˆ

ì—ì½”í”„ë¡œ (í˜„ì¬: ğŸ”¥ìŠ¤ìœ™)
  ğŸ“‰ ì„¹í„° ìˆ˜ê¸‰ ì „í™˜: ì™¸ì¸ 5ì¼ ì—°ì† ìˆœë§¤ë„
  ğŸ“Š ê¸°ìˆ ì : 20ì¼ì„  í•˜í–¥ ì´íƒˆ, MACD ë°ë“œí¬ë¡œìŠ¤
  ğŸ’¡ ìŠ¤ìœ™ â†’ ì†ì ˆ ê²€í† ë¡œ ë³€ê²½ì„ ì œì•ˆí•©ë‹ˆë‹¤

[âœ… ì „ëµ ë³€ê²½] [âŒ ìœ ì§€]
```

**ì¤‘ìš”: ì „ëµ ë³€ê²½ ì œì•ˆì€ ë‹¤ìŒ ê·¼ê±° ì¤‘ 2ê°œ ì´ìƒ ì¶©ì¡± ì‹œì—ë§Œ:**
- ì„¹í„°/ì‚°ì—… íë¦„ ë³€í™” (ì™¸ì¸/ê¸°ê´€ ìˆ˜ê¸‰ ì „í™˜)
- ê¸°ìˆ ì  ì „í™˜ì  (ì´ë™í‰ê· ì„  ì´íƒˆ, MACD ì „í™˜, RSI ê·¹ë‹¨)
- ë§¤í¬ë¡œ í™˜ê²½ ë³€í™” (VIX ê¸‰ë“±, í™˜ìœ¨ ê¸‰ë³€)
- ì‹¤ì /ì´ë²¤íŠ¸ ë³€í™” (ì»¨ì„¼ì„œìŠ¤ í•˜í–¥)

---

## Part B: ì¥ë°”êµ¬ë‹ˆ ë§¤ìˆ˜ ëª¨ë“œ

### "ë§¤ìˆ˜ ì‹œì‘" ëˆ„ë¥¸ í›„

```
ğŸ’° íˆ¬ì ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (ë§Œì› ë‹¨ìœ„)

ì˜ˆ: 50 â†’ 50ë§Œì›, 300 â†’ 300ë§Œì›
```

### ê¸ˆì•¡ ì…ë ¥ í›„ â†’ ì¥ë°”êµ¬ë‹ˆ ëª¨ë“œ ì§„ì…

```
â° 300ë§Œì› ì˜ˆì‚° í™•ì¸

ì¢…ëª©ì„ ì„ íƒí•˜ì„¸ìš”. ì—¬ëŸ¬ ì¢…ëª©ì„ ìˆœì„œëŒ€ë¡œ ë‹´ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[âš¡ ë‹¨íƒ€ ì¢…ëª© ë³´ê¸°]
[ğŸ”¥ ìŠ¤ìœ™ ì¢…ëª© ë³´ê¸°]
[ğŸ“Š í¬ì§€ì…˜ ì¢…ëª© ë³´ê¸°]
[ğŸ’ ì¥ê¸° ì¢…ëª© ë³´ê¸°]
[ğŸ¤– AI ì¶”ì²œ ë°›ê¸°]
[âœ… ì„ íƒ ì™„ë£Œ]
```

### "ğŸ¤– AI ì¶”ì²œ ë°›ê¸°" ëˆ„ë¥´ë©´

AIê°€ ì˜ˆì‚° + ì‹œì¥ ìƒí™© + ë³´ìœ ì¢…ëª©ì„ ì¢…í•© ë¶„ì„í•˜ì—¬ ìµœì  ì¡°í•© ìë™ ì¶”ì²œ:

```
ğŸ¤– AI ì¶”ì²œ í¬íŠ¸í´ë¦¬ì˜¤ (300ë§Œì›)

í˜„ì¬ ë³´ìœ : ì‚¼ì„±ì „ì(ì¥ê¸°), ì—ì½”í”„ë¡œ(ìŠ¤ìœ™)
â†’ ë‹¨ê¸° ì¢…ëª© ë¹„ì¤‘ì´ ì—†ì–´ ê· í˜•ì„ ìœ„í•´ ë‹¨íƒ€+ìŠ¤ìœ™ ì¡°í•© ì œì•ˆ

1ï¸âƒ£ KODEX ë ˆë²„ë¦¬ì§€ (âš¡ë‹¨íƒ€) â€” 105ë§Œì› (35%)
   RSI 35 ê³¼ë§¤ë„ + ê±°ë˜ëŸ‰ +45%
   ğŸ¯ +5% | ğŸ”´ -3%

2ï¸âƒ£ í˜„ëŒ€ì°¨ (ğŸ”¥ìŠ¤ìœ™) â€” 120ë§Œì› (40%)
   ì™¸ì¸ 3ì¼ ìˆœë§¤ìˆ˜ + 5ì¼ì„  ëŒíŒŒ
   ğŸ¯ +7% | ğŸ”´ -3%

3ï¸âƒ£ SKí•˜ì´ë‹‰ìŠ¤ (ğŸ’ì¥ê¸°) â€” 75ë§Œì› (25%)
   ë°˜ë„ì²´ ì—…ì‚¬ì´í´ 1/3 ë¶„í• ë§¤ìˆ˜
   ğŸ¯ +15% | ğŸ”´ -10%

ğŸ’¡ í‰ê·  E[R]: +3.2% | ìµœëŒ€ ì†ì‹¤: 12,000ì›

[âœ… ì „ì²´ ë‹´ê¸°] [í•˜ë‚˜ì”© ì„ íƒ]
```

### "âš¡ ë‹¨íƒ€ ì¢…ëª© ë³´ê¸°" ëˆ„ë¥´ë©´

```
âš¡ ë‹¨íƒ€ ì¶”ì²œ ì¢…ëª©

1ï¸âƒ£ KODEX ë ˆë²„ë¦¬ì§€ (122630) [ë¦¬ìŠ¤í¬ B]
   í˜„ì¬ê°€: 17,850ì› | ì ìˆ˜: 78ì 
   ATR 2.1% | RSI 35 | ê±°ë˜ëŸ‰ +45%
   ğŸ¯ +5~10% | ğŸ”´ -3%

2ï¸âƒ£ KODEX 200ì„ ë¬¼ì¸ë²„ìŠ¤2X (252670) [ë¦¬ìŠ¤í¬ B]
   í˜„ì¬ê°€: 3,215ì› | ì ìˆ˜: 72ì 
   ATR 3.8% | RSI 28 | ê±°ë˜ëŸ‰ +60%
   ğŸ¯ +5~10% | ğŸ”´ -3%

[1ï¸âƒ£ ë‹´ê¸°] [2ï¸âƒ£ ë‹´ê¸°] [ğŸ”™ ëŒì•„ê°€ê¸°]
```

### "1ï¸âƒ£ ë‹´ê¸°" ëˆ„ë¥´ë©´ â†’ ì¥ë°”êµ¬ë‹ˆ ì—…ë°ì´íŠ¸ + ë‹¤ì‹œ ì„ íƒ í™”ë©´

```
âœ… KODEX ë ˆë²„ë¦¬ì§€ ë‹´ê¹€

ğŸ›’ ì¥ë°”êµ¬ë‹ˆ (1/?)
  1. KODEX ë ˆë²„ë¦¬ì§€ (âš¡ë‹¨íƒ€) â€” Kelly 35% â†’ 105ë§Œì›, 58ì£¼

ğŸ’° ë‚¨ì€ ì˜ˆì‚°: 195ë§Œì›

[âš¡ ë‹¨íƒ€ ì¢…ëª© ë³´ê¸°]
[ğŸ”¥ ìŠ¤ìœ™ ì¢…ëª© ë³´ê¸°]
[ğŸ“Š í¬ì§€ì…˜ ì¢…ëª© ë³´ê¸°]
[ğŸ’ ì¥ê¸° ì¢…ëª© ë³´ê¸°]
[ğŸ¤– AI ì¶”ì²œ ë°›ê¸°]
[âœ… ì„ íƒ ì™„ë£Œ]
```

**í•µì‹¬: ì¢…ë£Œ ë²„íŠ¼(âœ… ì„ íƒ ì™„ë£Œ)ì„ ëˆ„ë¥¼ ë•Œê¹Œì§€ ê³„ì† ë‹´ê¸° ë£¨í”„ê°€ ì´ì–´ì§!**

### "âœ… ì„ íƒ ì™„ë£Œ" ëˆ„ë¥´ë©´ â†’ ìµœì¢… í™•ì¸

```
ğŸ“‹ ì£¼í˜¸ë‹˜ ìµœì¢… ë§¤ìˆ˜ ê³„íš

ğŸ’° ì´ ì˜ˆì‚°: 300ë§Œì› | ì‚¬ìš©: 267ë§Œì› | ì—¬ìœ : 33ë§Œì›

1ï¸âƒ£ KODEX ë ˆë²„ë¦¬ì§€ (âš¡ë‹¨íƒ€)
   ğŸŸ¢ ë§¤ìˆ˜: 17,700~17,900ì› (58ì£¼, 105ë§Œì›)
   ğŸ¯ ëª©í‘œ: 18,750ì› (+5%)
   ğŸ”´ ì†ì ˆ: 17,315ì› (-3%)
   ğŸ“Š ë°°ë¶„: 35% (Kelly) | E[R]: +2.4%
   ğŸ’¡ 09:10 ê±°ë˜ëŸ‰ í™•ì¸ í›„ ì§„ì…

2ï¸âƒ£ í˜„ëŒ€ì°¨ (ğŸ”¥ìŠ¤ìœ™)
   ğŸŸ¢ ë§¤ìˆ˜: 235,000~238,000ì› (1ì£¼, ì•½ 24ë§Œì›)
   ğŸ¯ ëª©í‘œ: 252,000ì› (+7%)
   ğŸ”´ ì†ì ˆ: 228,000ì› (-3%)
   ğŸ“Š ë°°ë¶„: 40% | E[R]: +3.1%
   ğŸ’¡ ì¥ì´ˆë°˜ ì™¸ì¸ ë§¤ìˆ˜ í™•ì¸ í›„

3ï¸âƒ£ SKí•˜ì´ë‹‰ìŠ¤ (ğŸ’ì¥ê¸°)
   ğŸŸ¢ ë§¤ìˆ˜: 178,000ì› (1ì£¼, ë¶„í• ë§¤ìˆ˜ 1/3)
   ğŸ¯ ëª©í‘œ: 205,000ì› (+15%)
   ğŸ”´ ì†ì ˆ: 160,200ì› (-10%)
   ğŸ“Š ë°°ë¶„: 25% | E[R]: +5.5%
   ğŸ’¡ ë¶„í• ë§¤ìˆ˜. ì¶”ê°€ ë§¤ìˆ˜ íƒ€ì´ë°ì€ ì¶”í›„ ì•ˆë‚´

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš¡ ë‹¨íƒ€ â†’ ì¥ì¤‘ ëª¨ë‹ˆí„°ë§ ì£¼ê¸° ë‹¨ì¶• (ê¸‰ë“±ì‹œ ì‹¤ì‹œê°„)
ğŸ”¥ ìŠ¤ìœ™ â†’ ë§¤ì¼ ëª©í‘œê°€/ì†ì ˆê°€ ì ê²€
ğŸ’ ì¥ê¸° â†’ ì£¼ 1íšŒ ì ê²€

âš ï¸ ì°¸ê³ ìš© ë¶„ì„ì´ë©° íˆ¬ì ì§€ì‹œê°€ ì•„ë‹™ë‹ˆë‹¤
ğŸ’¡ í‰ê·  E[R]: +3.2% | ìµœëŒ€ ì†ì‹¤: ì•½ 12,000ì›

[âœ… í™•ì •] [ğŸ”„ ë‹¤ì‹œ ì„ íƒ] [âŒ ì·¨ì†Œ]
```

### "âœ… í™•ì •" ëˆ„ë¥´ë©´

- ì„ íƒí•œ ì¢…ëª©ë“¤ì„ ë³´ìœ ì¢…ëª©ìœ¼ë¡œ ë“±ë¡ (holding_type ìë™ ì„¤ì •)
- ë‹¨íƒ€ ì¢…ëª©: ëª¨ë‹ˆí„°ë§ ì£¼ê¸° ìë™ ë‹¨ì¶•
- ê° ì¢…ëª©ë³„ ëª©í‘œê°€/ì†ì ˆê°€ DB ì €ì¥
- ì¥ì¤‘ ëª¨ë‹ˆí„°ë§ ì‹œì‘

---

## Part C: ì¥ì¤‘ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ (KIS WebSocket)

### C-1: ê¸‰ë“± ê°ì§€

`job_ws_connect`ì—ì„œ WebSocket ì—°ê²° í›„ `self.ws.on_update(self._on_realtime_update)` ì½œë°± ë“±ë¡.

**ì½œë°±ì€ ë™ê¸° í•¨ìˆ˜ì—¬ì•¼ í•¨.** ë¹„ë™ê¸° ì‘ì—…ì€ `asyncio.create_task()` ì‚¬ìš©.

```python
def _on_realtime_update(self, event_type: str, ticker: str, data) -> None:
    if event_type != "price":
        return
    # ì¥ì¤‘ í™•ì¸ (09:00~15:20)
    # 1. ê¸‰ë“± ê°ì§€ (change_pct >= +3%, 30ë¶„ ì¿¨ë‹¤ìš´)
    # 2. ë³´ìœ ì¢…ëª© ëª©í‘œê°€/ì†ì ˆê°€ ì²´í¬ (1ì‹œê°„ ì¿¨ë‹¤ìš´)
```

ê¸‰ë“± ê°ì§€ ì¡°ê±´:
- `change_pct >= +3%` (ì „ì¼ ëŒ€ë¹„)
- ìŠ¤ì½”ì–´ 50ì  ì´ìƒ (ìŠ¤ìº” ìºì‹œì—ì„œ í™•ì¸)
- 30ë¶„ ì¿¨ë‹¤ìš´ (ë™ì¼ ì¢…ëª© ì¤‘ë³µ ë°©ì§€)

### C-2: ë‹¨íƒ€ ì¢…ëª© ëª¨ë‹ˆí„°ë§ ê°•í™”

ë‹¨íƒ€(holding_type == 'scalp') ì¢…ëª©ì´ ìˆì„ ë•Œ:
- ê¸°ë³¸ ëª¨ë‹ˆí„°ë§: 60ì´ˆ â†’ **15ì´ˆë¡œ ë‹¨ì¶•**
- ê¸‰ë“±/ê¸‰ë½ ê°ì§€ ì‹œ: **ì‹¤ì‹œê°„ ì•Œë¦¼** (WebSocket ì½œë°±)
- ìˆ˜ê¸‰ ì½”ì¹­ ë©”ì‹œì§€ ìë™ ë°œì†¡:

```
ğŸ“Š KODEX ë ˆë²„ë¦¬ì§€ ìˆ˜ê¸‰ ë¦¬í¬íŠ¸

í˜„ì¬ê°€: 18,200ì› (+1.9%)
ë§¤ìˆ˜ì”ëŸ‰/ë§¤ë„ì”ëŸ‰: 1.6 (ê°•í•œ ë§¤ìˆ˜ì„¸)
ê±°ë˜ëŸ‰: ì „ì¼ ë™ì‹œê°„ ëŒ€ë¹„ +85%

ğŸ’¡ ë§¤ìˆ˜ì„¸ ìœ ì§€ ì¤‘. ëª©í‘œê°€(+5%) ì ‘ê·¼ ì‹œ ë¶€ë¶„ ìµì ˆ ê²€í† 
```

- VIX ê¸‰ë³€ ì‹œ: **ì¦‰ì‹œ ê²½ê³ **

```
âš ï¸ VIX ê¸‰ë“± ê°ì§€: 18.2 â†’ 22.5 (+23.6%)

ë³´ìœ  ë‹¨íƒ€ ì¢…ëª© ì ê²€:
KODEX ë ˆë²„ë¦¬ì§€: 18,200ì› (+1.9%)

ğŸ’¡ ë³€ë™ì„± í™•ëŒ€ êµ¬ê°„. ëª©í‘œê°€ í•˜í–¥ ë˜ëŠ” ì¡°ê¸° ì²­ì‚° ê²€í† 
```

### C-3: ëª©í‘œê°€/ì†ì ˆê°€ ì•Œë¦¼

ë³´ìœ ì¢…ëª© í˜„ì¬ê°€ê°€ ë§¤ìˆ˜ê°€ ëŒ€ë¹„ ëª©í‘œ/ì†ì ˆ ë„ë‹¬ ì‹œ:

| holding_type | ëª©í‘œ ë„ë‹¬ | ì†ì ˆ ë„ë‹¬ |
|-------------|----------|----------|
| scalp (ë‹¨íƒ€) | +3~20% (ATRë³„) | -2~5% (ATRë³„) |
| swing (ìŠ¤ìœ™) | +5% | -3% |
| position (í¬ì§€ì…˜) | +12% | -7% |
| long_term (ì¥ê¸°) | +20% | -10% |

```
ğŸ¯ ëª©í‘œê°€ ë„ë‹¬: KODEX ë ˆë²„ë¦¬ì§€

í˜„ì¬ê°€: 18,750ì› (+5.0%)
ë§¤ìˆ˜ê°€: 17,850ì›
ìœ í˜•: âš¡ ë‹¨íƒ€

ğŸ’¡ ìˆ˜ìµ ì‹¤í˜„ì„ ê²€í† í•´ë³´ì„¸ìš”
```

```
ğŸ”´ ì†ì ˆê°€ ë„ë‹¬: ì—ì½”í”„ë¡œ

í˜„ì¬ê°€: 55,500ì› (-3.0%)
ë§¤ìˆ˜ê°€: 57,200ì›
ìœ í˜•: ğŸ”¥ ìŠ¤ìœ™

ğŸ’¡ í¬ì§€ì…˜ ì •ë¦¬ë¥¼ ê²€í† í•´ë³´ì„¸ìš”
```

### C-4: 14:30 ë‹¨íƒ€ ì²­ì‚° ë¦¬ë§ˆì¸ë”

```
â° ë‹¨íƒ€ ì¢…ëª© ì²­ì‚° ì ê²€ (14:30)

KODEX ë ˆë²„ë¦¬ì§€: 18,500ì› (+3.6%)
  ğŸ’¡ ëª©í‘œ ë¯¸ë‹¬ì´ì§€ë§Œ ìˆ˜ìµ ì¤‘. ì¢…ê°€ ë§¤ë„ ë˜ëŠ” ìµì ˆ ê²€í† 

ğŸ’¡ ë‹¹ì¼ ì²­ì‚° ì „ì œ. ì˜¤ë²„ë‚˜ì‡ ë¦¬ìŠ¤í¬ ìœ ì˜.
```

### C-5: ìŠ¤ìœ™ 3ì¼ ë¯¸ë‹¬ ê²€í†  (08:00 ë‹¤ìŒë‚ )

```
ğŸ“‹ ìŠ¤ìœ™ ì¢…ëª© ê²€í†  ì•Œë¦¼

3ê±°ë˜ì¼ ê²½ê³¼ + ìˆ˜ìµë¥  3% ë¯¸ë§Œ:
  í˜„ëŒ€ì°¨: 237,000ì› (+0.8%) [4ì¼ ë³´ìœ ]

ğŸ’¡ ë³¸ì „ ë§¤ë„ë¥¼ ê²€í† í•´ë³´ì„¸ìš”
ğŸ“Š ìê¸ˆì´ ë¬¶ì—¬ ìˆëŠ” ì‹œê°„ë„ ë¹„ìš©ì…ë‹ˆë‹¤ (ê¸°íšŒë¹„ìš©)
```

---

## Part D: ë³´ìœ ì¢…ëª© ì „ëµ ê´€ë¦¬ (ë³„ë„ ë©”ë‰´)

ì•„ì¹¨ ë¸Œë¦¬í•‘ ì™¸ì—ë„, ì‚¬ìš©ìê°€ ì–¸ì œë“  ë³´ìœ ì¢…ëª© ì „ëµì„ í™•ì¸/ë³€ê²½í•  ìˆ˜ ìˆëŠ” ë©”ë‰´.

ê¸°ì¡´ ë©”ë‰´(ğŸ“Š ë¶„ì„ ë“±)ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡:

```
ğŸ“Š ë³´ìœ ì¢…ëª© ì „ëµ í˜„í™©

1. ì‚¼ì„±ì „ì (ğŸ’ì¥ê¸°)
   ë§¤ìˆ˜ê°€: 72,800ì› | í˜„ì¬: 74,500ì› (+2.3%)
   ëª©í‘œ: +15% (84,000ì›) | ì†ì ˆ: -10% (65,520ì›)
   ë³´ìœ : 23ì¼ | ì§„í–‰ë¥ : 15%
   ì „ëµ ìƒíƒœ: ğŸŸ¢ ìˆœí•­

2. ì—ì½”í”„ë¡œ (ğŸ”¥ìŠ¤ìœ™)
   ë§¤ìˆ˜ê°€: 58,100ì› | í˜„ì¬: 57,200ì› (-1.5%)
   ëª©í‘œ: +7% (62,200ì›) | ì†ì ˆ: -3% (56,400ì›)
   ë³´ìœ : 4ì¼ | ì§„í–‰ë¥ : -21%
   ì „ëµ ìƒíƒœ: âš ï¸ ì†ì ˆ ì ‘ê·¼

3. KODEX ë ˆë²„ë¦¬ì§€ (âš¡ë‹¨íƒ€)
   ë§¤ìˆ˜ê°€: 17,850ì› | í˜„ì¬: 18,200ì› (+1.9%)
   ëª©í‘œ: +5% (18,750ì›) | ì†ì ˆ: -3% (17,315ì›)
   ë³´ìœ : 0ì¼ (ë‹¹ì¼)
   ì „ëµ ìƒíƒœ: ğŸŸ¢ ì§„í–‰ ì¤‘

[ğŸ”„ ì „ëµ ë³€ê²½] [ğŸ“Š ìƒì„¸ ë¶„ì„] [ğŸ”™ ëŒì•„ê°€ê¸°]
```

"ğŸ”„ ì „ëµ ë³€ê²½" ì„ íƒ ì‹œ:
```
ì–´ë–¤ ì¢…ëª©ì˜ ì „ëµì„ ë³€ê²½í• ê¹Œìš”?

[1ï¸âƒ£ ì‚¼ì„±ì „ì] [2ï¸âƒ£ ì—ì½”í”„ë¡œ] [3ï¸âƒ£ KODEXë ˆë²„ë¦¬ì§€]
```

ì¢…ëª© ì„ íƒ í›„:
```
ì—ì½”í”„ë¡œ í˜„ì¬ ì „ëµ: ğŸ”¥ ìŠ¤ìœ™ (3~5ì¼)

ë³€ê²½í•  ì „ëµì„ ì„ íƒí•˜ì„¸ìš”:

[âš¡ ë‹¨íƒ€ë¡œ ë³€ê²½] [ğŸ“Š í¬ì§€ì…˜ìœ¼ë¡œ ë³€ê²½] [ğŸ’ ì¥ê¸°ë¡œ ë³€ê²½]
[ğŸ”™ ì·¨ì†Œ]
```

**ì „ëµ ë³€ê²½ ì‹œ AIê°€ ì „ë¬¸ì  ì˜ê²¬ ì œì‹œ:**
```
ğŸ”„ ì—ì½”í”„ë¡œ ì „ëµ ë³€ê²½: ğŸ”¥ìŠ¤ìœ™ â†’ ğŸ“Ší¬ì§€ì…˜

AI ë¶„ì„:
  ğŸ“‰ í˜„ì¬ ì†ì‹¤ -1.5%ì´ì§€ë§Œ 2ì°¨ì „ì§€ ì„¹í„° ì¤‘ì¥ê¸° ì „ë§ì€ ê¸ì •ì 
  ğŸ“Š 20ì¼ì„ (58,500ì›)ì—ì„œ ì§€ì§€ ì‹œë„ ì¤‘
  ğŸ’¡ í¬ì§€ì…˜ìœ¼ë¡œ ì „í™˜ ì‹œ ëª©í‘œ +10%, ì†ì ˆ -7%ë¡œ ì¡°ì •
  âš ï¸ ë‹¨, 20ì¼ì„  ì´íƒˆ(57,000ì› ì´í•˜) ì‹œ ì¬ê²€í†  í•„ìš”

[âœ… ë³€ê²½ í™•ì •] [âŒ ì·¨ì†Œ]
```

---

## ì‘ì—… ì§€ì‹œ (êµ¬í˜„ ìˆœì„œ)

### ì‘ì—… 1: ìƒíƒœ ë³€ìˆ˜ + ìƒìˆ˜ ì •ì˜

**scheduler.py** â€” SchedulerMixin í´ë˜ìŠ¤ì— ì¶”ê°€:

```python
# ì¥ë°”êµ¬ë‹ˆ + ëª¨ë‹ˆí„°ë§ ìƒíƒœ
_surge_cooldown: dict[str, float] = {}
_SURGE_COOLDOWN_SEC = 1800       # ê¸‰ë“± ì•Œë¦¼ 30ë¶„ ì¿¨ë‹¤ìš´
_SELL_TARGET_COOLDOWN_SEC = 3600  # ë§¤ë„ ì•Œë¦¼ 1ì‹œê°„ ì¿¨ë‹¤ìš´
_SURGE_THRESHOLD_PCT = 3.0       # +3% ì´ìƒ ê°ì§€
_surge_callback_registered: bool = False
_holdings_cache: list = []
_current_monitor_interval: int = 60  # í˜„ì¬ ëª¨ë‹ˆí„°ë§ ì£¼ê¸° (ì´ˆ)
```

**trading.py** â€” ê¸°ê°„ë³„ ì„¤ì •:

```python
_HORIZON_CONFIG = {
    "scalp": {
        "strategies": {"B", "G"},
        "label": "âš¡ ë‹¨íƒ€",
        "emoji": "âš¡",
        "holding_type": "scalp",
        "monitor_interval": 15,  # ë‹¨íƒ€ ëª¨ë‹ˆí„°ë§ ì£¼ê¸° (ì´ˆ)
        "hold_desc": "ë‹¹ì¼~3ì¼. 14:30ê¹Œì§€ ëª©í‘œ ë¯¸ë‹¬ ì‹œ ì¢…ê°€ ì²­ì‚°.",
    },
    "swing": {
        "strategies": {"A", "G", "F"},
        "label": "ğŸ”¥ ìŠ¤ìœ™",
        "emoji": "ğŸ”¥",
        "holding_type": "swing",
        "monitor_interval": 60,
        "hold_desc": "3ì¼~2ì£¼. 3ì¼ ë‚´ +3% ë¯¸ë§Œì´ë©´ ë³¸ì „ ë§¤ë„ ê²€í† .",
    },
    "position": {
        "strategies": {"D", "F"},
        "label": "ğŸ“Š í¬ì§€ì…˜",
        "emoji": "ğŸ“Š",
        "holding_type": "position",
        "monitor_interval": 120,
        "hold_desc": "1~3ê°œì›”. ì£¼ 1íšŒ ê¸°ìˆ ì§€í‘œ ì ê²€.",
    },
    "long": {
        "strategies": {"C", "E"},
        "label": "ğŸ’ ì¥ê¸°",
        "emoji": "ğŸ’",
        "holding_type": "long_term",
        "monitor_interval": 300,
        "hold_desc": "6ê°œì›”+. ë¶„ê¸° ì‹¤ì  ê¸°ì¤€. ë°°ë‹¹ ìˆ˜ìµ í¬í•¨.",
    },
}

# ë‹¨íƒ€ ATR ë¦¬ìŠ¤í¬ ë“±ê¸‰
_SCALP_RISK_GRADES = {
    "A": {"atr_max": 2.0, "target_min": 3, "target_max": 5, "stop": -2, "label": "A (ì•ˆì •)", "win_rate": 0.65},
    "B": {"atr_max": 4.0, "target_min": 5, "target_max": 10, "stop": -3, "label": "B (ë³´í†µ)", "win_rate": 0.55},
    "C": {"atr_max": 999, "target_min": 10, "target_max": 20, "stop": -5, "label": "C (ê³µê²©)", "win_rate": 0.45},
}
```

### ì‘ì—… 2: ì•„ì¹¨ ë¸Œë¦¬í•‘ (07:50)

**core_handlers.py** â€” schedule_jobs()ì— ì¶”ê°€:
```python
jq.run_daily(
    self.job_morning_briefing,
    time=dt_time(hour=7, minute=50, tzinfo=KST),
    days=(0, 1, 2, 3, 4),
    name="morning_briefing",
)
self._application = app  # WebSocket ì½œë°±ì—ì„œ bot ì ‘ê·¼ìš©
```

**scheduler.py** â€” `job_morning_briefing` êµ¬í˜„:

ì•„ì¹¨ ë¸Œë¦¬í•‘ì€ 3ê°œ ì„¹ì…˜ì„ ì¡°í•©:
1. ë³´ìœ ì¢…ëª© í˜„í™© (DBì—ì„œ holdings ì¡°íšŒ + ì‹¤ì‹œê°„ ê°€ê²© or yfinance)
2. ì‹œì¥ ìƒí™© (macro_client.get_snapshot())
3. ê¸°ê°„ë³„ ì¶”ì²œ (_scan_all_stocks() â†’ ì „ëµë³„ í•„í„°ë§)

ë³´ìœ ì¢…ëª© ì „ëµ ë³€ê²½ ì œì•ˆì€ **Claude Sonnet AI**ê°€ íŒë‹¨:
- ë³´ìœ ì¢…ëª© ë°ì´í„° + ì‹œì¥ ìƒí™© + ê¸°ìˆ ì§€í‘œë¥¼ AIì—ê²Œ ì „ë‹¬
- "ì „ëµ ë³€ê²½ì´ í•„ìš”í•œ ì¢…ëª©ì´ ìˆìœ¼ë©´ ê·¼ê±°ì™€ í•¨ê»˜ ì œì•ˆí•˜ë¼. ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜" í”„ë¡¬í”„íŠ¸
- 2ê°œ ì´ìƒ ê·¼ê±° ì¶©ì¡± ì‹œì—ë§Œ ì œì•ˆ

### ì‘ì—… 3: ì¥ë°”êµ¬ë‹ˆ ë§¤ìˆ˜ ëª¨ë“œ

**í•µì‹¬: `user_data`ì— ì¥ë°”êµ¬ë‹ˆ ìƒíƒœ ì €ì¥**

```python
# user_data êµ¬ì¡°
context.user_data["buy_cart"] = {
    "budget": 3000000,          # ì´ ì˜ˆì‚° (ì›)
    "remaining": 3000000,       # ë‚¨ì€ ì˜ˆì‚°
    "items": [                  # ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ
        {
            "ticker": "122630",
            "name": "KODEX ë ˆë²„ë¦¬ì§€",
            "horizon": "scalp",
            "price": 17850,
            "quantity": 58,
            "amount": 1035300,
            "kelly_frac": 0.35,
            "target_pct": 5.0,
            "stop_pct": -3.0,
            "risk_grade": "B",
        },
    ],
    "active": True,             # ì¥ë°”êµ¬ë‹ˆ ëª¨ë“œ í™œì„±í™”
}
```

**ì½œë°± ë°ì´í„° ì„¤ê³„:**

| ì½œë°± | ì˜ë¯¸ |
|------|------|
| `bp:start` | ë§¤ìˆ˜ ì‹œì‘ |
| `bp:no` | ì˜¤ëŠ˜ì€ ì‰´ê²Œ |
| `bp:view:{horizon}` | ê¸°ê°„ë³„ ì¢…ëª© ë³´ê¸° (scalp/swing/position/long) |
| `bp:ai` | AI ì¶”ì²œ ë°›ê¸° |
| `bp:add:{ticker}:{horizon}` | ì¢…ëª© ë‹´ê¸° |
| `bp:done` | ì„ íƒ ì™„ë£Œ |
| `bp:confirm` | ìµœì¢… í™•ì • |
| `bp:retry` | ë‹¤ì‹œ ì„ íƒ |
| `bp:cancel` | ì·¨ì†Œ |

**trading.py â€” ì½œë°± í•¸ë“¤ëŸ¬:**

```python
async def _action_buy_plan(self, query, context, payload: str) -> None:
    """ë§¤ìˆ˜ í”Œë˜ë„ˆ ì½œë°± í•¸ë“¤ëŸ¬. ì¥ë°”êµ¬ë‹ˆ ëª¨ë“œ."""

    if payload == "start":
        # ì˜ˆì‚° ì…ë ¥ ëª¨ë“œ
        context.user_data["awaiting_buy_amount"] = True
        await query.edit_message_text("ğŸ’° íˆ¬ì ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (ë§Œì› ë‹¨ìœ„)")
        return

    if payload == "no":
        await query.edit_message_text("ğŸ–ï¸ ì¢‹ì€ í•˜ë£¨ ë³´ë‚´ì„¸ìš”!")
        return

    if payload.startswith("view:"):
        horizon = payload.split(":")[1]
        # í•´ë‹¹ ê¸°ê°„ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ í‘œì‹œ + [ë‹´ê¸°] ë²„íŠ¼
        await self._show_horizon_picks(query, context, horizon)
        return

    if payload == "ai":
        # AIê°€ ìµœì  ì¡°í•© ì¶”ì²œ
        await self._show_ai_recommendation(query, context)
        return

    if payload.startswith("add:"):
        parts = payload.split(":")
        ticker, horizon = parts[1], parts[2]
        # ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ + ë‚¨ì€ ì˜ˆì‚° í‘œì‹œ + ë‹¤ì‹œ ì„ íƒ í™”ë©´
        await self._add_to_cart(query, context, ticker, horizon)
        return

    if payload == "done":
        # ìµœì¢… í™•ì¸ í™”ë©´
        await self._show_cart_summary(query, context)
        return

    if payload == "confirm":
        # í™•ì •: ë³´ìœ ì¢…ëª© ë“±ë¡ + ëª¨ë‹ˆí„°ë§ ì‹œì‘
        await self._confirm_cart(query, context)
        return

    if payload == "retry":
        # ì¥ë°”êµ¬ë‹ˆ ì´ˆê¸°í™”í•˜ì§€ ì•Šê³  ë‹¤ì‹œ ì„ íƒ í™”ë©´
        await self._show_cart_menu(query, context)
        return

    if payload == "cancel":
        context.user_data.pop("buy_cart", None)
        await query.edit_message_text("âŒ ë§¤ìˆ˜ ê³„íšì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.")
        return
```

**core_handlers.py â€” handle_menu_textì— ê¸ˆì•¡ ì…ë ¥ ì²˜ë¦¬ ì¶”ê°€** (ê°€ì¥ ì•ë¶€ë¶„ì—):

```python
if context.user_data.get("awaiting_buy_amount"):
    import re
    nums = re.findall(r'\d+', update.message.text.strip())
    if nums:
        amount = int(nums[0]) * 10000
        context.user_data["awaiting_buy_amount"] = False
        context.user_data["buy_cart"] = {
            "budget": amount,
            "remaining": amount,
            "items": [],
            "active": True,
        }
        # ì¥ë°”êµ¬ë‹ˆ ë©”ë‰´ í‘œì‹œ
        await self._show_cart_menu(update, context)
        return
```

### ì‘ì—… 4: AI ì¶”ì²œ (_show_ai_recommendation)

Claude Sonnetìœ¼ë¡œ ì˜ˆì‚° + ì‹œì¥ + ë³´ìœ ì¢…ëª©ì„ ì¢…í•© ë¶„ì„í•˜ì—¬ ìµœì  ì¡°í•© ì¶”ì²œ.

ê¸°ì¡´ `_scan_all_stocks()` ê²°ê³¼ë¥¼ ì „ ê¸°ê°„ ì „ëµì— ê±¸ì³ í•„í„°ë§ â†’ ìƒìœ„ ì¢…ëª© ë°ì´í„°ë¥¼ AIì—ê²Œ ì „ë‹¬.

AI í”„ë¡¬í”„íŠ¸ì— í¬í•¨í•  ê²ƒ:
- í˜„ì¬ ë³´ìœ ì¢…ëª© (ê¸°ê°„/ì¢…ëª© ì¤‘ë³µ ë°©ì§€)
- ì˜ˆì‚°
- ì‹œì¥ ë ˆì§ (ê³µê²©/ê· í˜•/ë°©ì–´)
- ê¸°ê°„ë³„ ìƒìœ„ ì¢…ëª© ë°ì´í„° (ìŠ¤ì½”ì–´, ê¸°ìˆ ì§€í‘œ, ì „ëµ ì‹ í˜¸)
- Kelly ë°°ë¶„ + E[R] ì‚¬ì „ ê³„ì‚°ê°’

AI ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸:
```
ë„ˆëŠ” ì£¼í˜¸ë‹˜ì˜ ì „ì† íˆ¬ì ì°¸ëª¨ 'í€€íŠ¸ë´‡'ì´ë‹¤.
CFA/CAIA + ê³„ëŸ‰ê¸ˆìœµ ì „ë¬¸ê°€.

[ì ˆëŒ€ ê·œì¹™]
1. ë§¤ë§¤ 'ì§€ì‹œ' ê¸ˆì§€. 'ê²€í† í•´ë³´ì„¸ìš”' ì‹ìœ¼ë¡œ
2. ì œê³µëœ ë°ì´í„°ë§Œ ì‚¬ìš©. í•™ìŠµ ë°ì´í„°ì˜ ê³¼ê±° ê°€ê²© ê¸ˆì§€
3. ë³¼ë“œ(**) ê¸ˆì§€. ì´ëª¨ì§€ë¡œ êµ¬ë¶„
4. Kelly ë°°ë¶„ ë¹„ìœ¨ê³¼ E[R] ì°¸ê³ í•˜ì—¬ ë°°ë¶„
5. ê¸°ì¡´ ë³´ìœ ì¢…ëª©ê³¼ ì„¹í„°/ê¸°ê°„ ë¶„ì‚° ê³ ë ¤
6. ì‹œì¥ì´ ë¶ˆì•ˆí•˜ë©´ 'ê´€ë§' ê¶Œê³ 
7. ë‹¨íƒ€ Cë“±ê¸‰(ATR>4%) ì¢…ëª©ì€ 'ê³ ìœ„í—˜' ê²½ê³ 
8. ì „ì²´ í¬íŠ¸í´ë¦¬ì˜¤ ê´€ì ì—ì„œ ì¶”ì²œ (ê°œë³„ ì¢…ëª© X, ì¡°í•© O)
```

### ì‘ì—… 5: í™•ì • ì‹œ ë³´ìœ ì¢…ëª© ë“±ë¡ + ëª¨ë‹ˆí„°ë§ ê°•í™”

`_confirm_cart` ë©”ì„œë“œ:

1. ì¥ë°”êµ¬ë‹ˆ ì•„ì´í…œ â†’ `db.add_holding()` ë˜ëŠ” `db.upsert_holding()` (holding_type í¬í•¨)
2. ë‹¨íƒ€ ì¢…ëª©ì´ ìˆìœ¼ë©´ â†’ ëª¨ë‹ˆí„°ë§ interval ë‹¨ì¶•
   - `_current_monitor_interval`ì„ 15ì´ˆë¡œ ë³€ê²½
   - ê¸°ì¡´ intraday_monitor ì¡ reschedule
3. ê° ì¢…ëª©ë³„ ëª©í‘œê°€/ì†ì ˆê°€ â†’ `holding_analysis` í…Œì´ë¸” ë˜ëŠ” ë³„ë„ ì €ì¥

### ì‘ì—… 6: WebSocket ì½œë°± ë“±ë¡ + ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§

**scheduler.py â€” job_ws_connectì— ì½œë°± ë“±ë¡ ì¶”ê°€:**

```python
if not self._surge_callback_registered:
    self.ws.on_update(self._on_realtime_update)
    self._surge_callback_registered = True
```

**scheduler.py â€” _on_realtime_update (ë™ê¸° í•¨ìˆ˜):**

```python
def _on_realtime_update(self, event_type, ticker, data):
    if event_type != "price":
        return
    now = time.time()
    now_kst = datetime.now(KST)
    if now_kst.hour < 9 or (now_kst.hour >= 15 and now_kst.minute > 20):
        return

    # 1. ê¸‰ë“± ê°ì§€
    if data.change_pct >= self._SURGE_THRESHOLD_PCT:
        key = f"surge:{ticker}"
        if now - self._surge_cooldown.get(key, 0) >= self._SURGE_COOLDOWN_SEC:
            self._surge_cooldown[key] = now
            asyncio.create_task(self._send_surge_alert(ticker, data))

    # 2. ë³´ìœ ì¢…ëª© ëª©í‘œ/ì†ì ˆ ì²´í¬
    self._check_sell_targets(ticker, data, now)
```

**bot ì¸ìŠ¤í„´ìŠ¤ ì ‘ê·¼:** `self._application.bot` (schedule_jobsì—ì„œ `self._application = app` ì €ì¥)

**ì£¼ì˜:** `on_update` ì½œë°±ì€ ë™ê¸° í•¨ìˆ˜. `asyncio.create_task()`ë¡œ ë¹„ë™ê¸° ì‘ì—… ìŠ¤ì¼€ì¤„. ì´ë²¤íŠ¸ ë£¨í”„ ì»¨í…ìŠ¤íŠ¸ í™•ì¸ í•„ìš” â€” WebSocketì´ ë³„ë„ ìŠ¤ë ˆë“œë©´ `loop.call_soon_threadsafe()` ì‚¬ìš©.

### ì‘ì—… 7: ë‹¨íƒ€ ìˆ˜ê¸‰ ì½”ì¹­

ë‹¨íƒ€ ì¢…ëª© ë³´ìœ  ì‹œ, `job_intraday_monitor`ì—ì„œ ì¶”ê°€ ìˆ˜ê¸‰ ë¶„ì„:

```python
# job_intraday_monitor ì‹œì‘ ë¶€ë¶„ì— ì¶”ê°€
self._holdings_cache = self.db.get_active_holdings()

# ë‹¨íƒ€ ì¢…ëª©ì´ ìˆìœ¼ë©´ ìˆ˜ê¸‰ ì½”ì¹­ ë©”ì‹œì§€
scalp_holdings = [h for h in self._holdings_cache if h.get("holding_type") == "scalp"]
if scalp_holdings:
    for h in scalp_holdings:
        rt = self.ws.get_price(h["ticker"])
        if rt:
            # ë§¤ìˆ˜/ë§¤ë„ ì”ëŸ‰ ë¹„ìœ¨, ê±°ë˜ëŸ‰ ë³€í™” ë“± ë¶„ì„
            # ì˜ë¯¸ ìˆëŠ” ë³€í™”ê°€ ìˆì„ ë•Œë§Œ ì½”ì¹­ ë©”ì‹œì§€ ë°œì†¡
            pass
```

### ì‘ì—… 8: ìŠ¤ì¼€ì¤„ ì¡ ì¶”ê°€ ë“±ë¡

**schedule_jobs()ì— ì¶”ê°€:**

```python
# 14:30 ë‹¨íƒ€ ì²­ì‚° ë¦¬ë§ˆì¸ë”
jq.run_daily(
    self.job_scalp_close_reminder,
    time=dt_time(hour=14, minute=30, tzinfo=KST),
    days=(0, 1, 2, 3, 4),
    name="scalp_close_reminder",
)

# 08:00 ìŠ¤ìœ™ 3ì¼ ë¯¸ë‹¬ ê²€í† 
jq.run_daily(
    self.job_swing_review,
    time=dt_time(hour=8, minute=0, tzinfo=KST),
    days=(0, 1, 2, 3, 4),
    name="swing_review",
)
```

### ì‘ì—… 9: core_handlers.py â€” ì½œë°± dispatch ì¶”ê°€

```python
"bp": self._action_buy_plan,
"strat": self._action_strategy_change,  # ì „ëµ ë³€ê²½
```

### ì‘ì—… 10: ë³´ìœ ì¢…ëª© ì „ëµ ë³€ê²½ ë©”ë‰´

ê¸°ì¡´ ë©”ë‰´ ì²´ê³„ì— "ë³´ìœ ì¢…ëª© ì „ëµ" ì ‘ê·¼ì  ì¶”ê°€.
`_action_strategy_change` ì½œë°± í•¸ë“¤ëŸ¬ êµ¬í˜„:

ì½œë°±:
- `strat:view` â€” ì „ëµ í˜„í™© ë³´ê¸°
- `strat:change:{ticker}` â€” ì¢…ëª© ì„ íƒ
- `strat:set:{ticker}:{new_type}` â€” ìƒˆ ì „ëµ ì„¤ì • â†’ AI ì˜ê²¬ ìš”ì²­
- `strat:confirm:{ticker}:{new_type}` â€” í™•ì •
- `strat:cancel` â€” ì·¨ì†Œ

---

## ê²€ì¦

1. `PYTHONPATH=src python3 -m pytest tests/ -x -q` ì „ì²´ í†µê³¼
2. `grep -rn "morning_briefing\|job_morning" src/` â†’ ì•„ì¹¨ ë¸Œë¦¬í•‘ ë“±ë¡ í™•ì¸
3. `grep -rn "buy_cart\|bp:" src/` â†’ ì¥ë°”êµ¬ë‹ˆ ëª¨ë“œ í™•ì¸
4. `grep -rn "on_update\|_on_realtime_update" src/` â†’ WebSocket ì½œë°± í™•ì¸
5. `grep -rn "scalp_close_reminder\|swing_review" src/` â†’ ë§¤ë„ ê°€ì´ë“œ ì¡ í™•ì¸
6. `grep -rn "strat:" src/` â†’ ì „ëµ ë³€ê²½ ë©”ë‰´ í™•ì¸
7. ì‹¤ì œ í…ŒìŠ¤íŠ¸: í…”ë ˆê·¸ë¨ì—ì„œ ì „ì²´ íë¦„ í…ŒìŠ¤íŠ¸

## ì£¼ì˜ì‚¬í•­

| í•­ëª© | ì£¼ì˜ |
|------|------|
| on_update ì½œë°± | ë™ê¸° í•¨ìˆ˜. asyncëŠ” `asyncio.create_task()`. ìŠ¤ë ˆë“œ ì»¨í…ìŠ¤íŠ¸ í™•ì¸ |
| bot ì ‘ê·¼ | `self._application = app` schedule_jobs()ì—ì„œ ì €ì¥ |
| ì¥ë°”êµ¬ë‹ˆ ìƒíƒœ | `context.user_data["buy_cart"]`ì— ì €ì¥. ë´‡ ì¬ì‹œì‘ ì‹œ ì´ˆê¸°í™”ë¨ |
| ê¸‰ë“± ê°ì§€ | ì¥ì¤‘(09:00~15:20)ë§Œ. 30ë¶„ ì¿¨ë‹¤ìš´ |
| ë§¤ë„ ì•Œë¦¼ | 1ì‹œê°„ ì¿¨ë‹¤ìš´ (ë™ì¼ ì¢…ëª©) |
| ë‹¨íƒ€ ëª¨ë‹ˆí„°ë§ | ê¸°ë³¸ 15ì´ˆ. VIX ê¸‰ë“± ì‹œ ì‹¤ì‹œê°„ |
| ì „ëµ ë³€ê²½ | AI ì „ë¬¸ ì˜ê²¬ í•„ìˆ˜. ê·¼ê±° 2ê°œ ì´ìƒ |
| ê°€ê²© ë°ì´í„° | í•™ìŠµ ë°ì´í„° ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€. ì‹¤ì‹œê°„ KIS/yfinanceë§Œ |
| ë§¤ë„ ì œì•ˆ | holding_type í™•ì¸ í•„ìˆ˜. ì¥ê¸° ì¢…ëª©ì— ë‹¨ê¸° ë§¤ë„ ì œì•ˆ ê¸ˆì§€ |
| TechnicalIndicators.atr_pct | ì´ ì†ì„±ì´ ì¡´ì¬í•˜ëŠ”ì§€ ë¨¼ì € í™•ì¸. ì—†ìœ¼ë©´ ATR(20)/í˜„ì¬ê°€*100ìœ¼ë¡œ ê³„ì‚° ì¶”ê°€ |
| E[R] í•„í„° | ê¸°ëŒ€ìˆ˜ìµ < 0.5%(ê±°ë˜ë¹„ìš©)ì´ë©´ ì¶”ì²œ ì•ˆ í•¨ |
| Kelly ë°°ë¶„ | Half Kelly ì ìš©. 5~40% ë²”ìœ„ |
| ì‹œì¥ ë ˆì§ | VIX > 25 ë°©ì–´ ëª¨ë“œì—ì„œ ë‹¨íƒ€ ë¹„ì¶”ì²œ |
| ìˆ˜ê¸‰ ë°ì´í„° | macro_client mock ê°€ëŠ¥ì„±. ê¸°ìˆ ì  ì§€í‘œ ìš°ì„  |
